{"version":3,"names":["dropdownCss","Dropdown","constructor","hostRef","this","disabled","managed","open","placements","trigger","hidePopover","closeEvent","emit","showPopover","setTimeout","menuRef","setFocus","openEvent","componentDidLoad","contentRef","host","querySelector","Error","popoverController","PopoverController","triggerRef","slotRef","assignedElements","nodeName","length","registerTarget","setTriggerRef","addEventListener","evt","zaneDropdownItemClick","detail","setFocusOnTrigger","key","preventDefault","componentDidUpdate","setOpen","computePositionThrottle","disconnectedCallback","destroy","render","h","Host","class","dropdown","ref","el","resizeHandler","focus","windowClickHandler"],"sources":["src/components/dropdown/dropdown/dropdown.scss?tag=zane-dropdown&encapsulation=shadow","src/components/dropdown/dropdown/dropdown.tsx"],"sourcesContent":["@use '../../../global/styles/commons';\n\n:host {\n  --dropdown-height: inherit;\n\n  display: inline-block;\n  height: var(--dropdown-height);\n}\n\n.dropdown {\n  display: inline-block;\n  height: var(--dropdown-height);\n\n  zane-menu {\n    --zane-menu-shadow: none;\n  }\n}\n","import {\n  Component,\n  ComponentInterface,\n  Element,\n  Event,\n  EventEmitter,\n  h,\n  Host,\n  Listen,\n  Method,\n  Prop,\n} from '@stencil/core';\n\nimport PopoverController from '../../popover/popover/popover-controller';\n\n/**\n * 下拉菜单组件\n * @Component 装饰器定义组件元数据\n * @shadow 启用Shadow DOM封装\n * @styleUrl 组件样式表路径\n * @tag 组件自定义标签名称\n */\n@Component({\n  shadow: true,\n  styleUrl: 'dropdown.scss',\n  tag: 'zane-dropdown',\n})\nexport class Dropdown implements ComponentInterface {\n\n  /**\n   * 下拉菜单关闭事件\n   * @Event 装饰器定义自定义事件\n   * 事件名称为'zane-dropdown--close'\n   */\n  @Event({ eventName: 'zane-dropdown--close' }) closeEvent: EventEmitter;\n\n  /**\n   * 是否禁用下拉菜单\n   * @Prop 默认值为false\n   */\n  @Prop() disabled: boolean = false;\n\n  /**\n   * 宿主元素引用\n   * @Element 装饰器获取宿主元素\n   */\n  @Element() host!: HTMLElement;\n\n  /**\n   * 是否为受控模式\n   * 在受控模式下，组件的状态完全由外部控制\n   * @Prop 装饰器，reflect表示会反映到DOM属性上\n   */\n  @Prop({ reflect: true }) managed: boolean = false;\n\n  /**\n   * 下拉菜单内容区域的引用\n   */\n  menuRef: HTMLZaneDropdownMenuElement;\n\n  /**\n   * 下拉菜单是否打开\n   * @Prop 装饰器，mutable表示属性可变，reflect表示会反映到DOM属性上\n   */\n  @Prop({ mutable: true, reflect: true }) open: boolean = false;\n\n  /**\n   * 下拉菜单打开事件\n   * @Event 装饰器定义自定义事件\n   * 事件名称为'zane-dropdown--open'\n   */\n  @Event({ eventName: 'zane-dropdown--open' }) openEvent: EventEmitter;\n\n  /**\n   * 下拉菜单位置选项\n   * 多个位置用逗号分隔，按优先级排序\n   * @Prop 装饰器，reflect表示会反映到DOM属性上\n   * 默认值为'bottom-start,top-start,bottom-end,top-end'\n   */\n  @Prop({ reflect: true }) placements: string =\n    'bottom-start,top-start,bottom-end,top-end';\n\n  /**\n   * Popover控制器实例\n   * 用于管理弹出位置、显示/隐藏等逻辑\n   */\n  popoverController: PopoverController;\n\n  /**\n   * 触发器插槽引用\n   */\n  slotRef: HTMLSlotElement;\n\n  /**\n   * 触发下拉菜单的方式\n   * - 'click': 点击触发\n   * - 'hover': 悬停触发\n   * - 'manual': 手动控制\n   * @Prop 装饰器，reflect表示会反映到DOM属性上\n   * 默认值为'click'\n   */\n  @Prop({ reflect: true }) trigger: 'click' | 'hover' | 'manual' = 'click';\n\n  /**\n   * 触发器元素引用\n   * 可以是任何HTML元素或zane-button组件\n   */\n  triggerRef: HTMLElement | HTMLZaneButtonElement;\n\n  /**\n   * 菜单项点击事件\n   * @Event 装饰器定义自定义事件\n   * 事件名称为'zane-dropdown--item-click'\n   */\n  @Event({ eventName: 'zane-dropdown--item-click' })\n  zaneDropdownItemClick: EventEmitter;\n\n  /**\n   * 组件加载完成生命周期钩子\n   * 初始化下拉菜单控制器和事件监听\n   */\n  componentDidLoad() {\n    // 获取下拉菜单内容区域\n    const contentRef = this.host.querySelector('zane-dropdown-menu');\n\n    if (!contentRef) {\n      throw new Error(\n        'zane-dropdown: The dropdown component must have a zane-dropdown-menu child component',\n      );\n    }\n\n    this.menuRef = contentRef;\n\n    // 初始化Popover控制器\n    this.popoverController = new PopoverController(\n      this.host,\n      this.trigger,\n      this.open,\n      contentRef,\n      0,\n      0,\n      this.showPopover,\n      this.hidePopover,\n      this.placements,\n    );\n\n    // 获取触发器元素\n    this.triggerRef = this.slotRef.assignedElements()[0] as HTMLElement;\n    if (this.triggerRef.nodeName === 'SLOT') {\n      const assignedElements = (\n        this.triggerRef as HTMLSlotElement\n      ).assignedElements();\n      if (assignedElements.length > 0) {\n        this.triggerRef = assignedElements[0] as HTMLSlotElement;\n      }\n    }\n\n    // 注册触发器并设置引用\n    this.popoverController.registerTarget(this.triggerRef);\n    this.popoverController.setTriggerRef(this.triggerRef);\n\n    // 监听菜单项点击事件\n    this.host.addEventListener('zane-menu-item--click', (evt: CustomEvent) => {\n      this.zaneDropdownItemClick.emit(evt.detail);\n      this.setFocusOnTrigger();\n      this.popoverController.hidePopover();\n    });\n\n    // 监听ESC键关闭下拉菜单\n    this.host.addEventListener('keydown', (evt) => {\n      if (evt.key === 'Escape') {\n        evt.preventDefault();\n        this.popoverController.hidePopover();\n      }\n    });\n  }\n\n  /**\n   * 组件更新生命周期钩子\n   * 更新Popover控制器的状态\n   */\n  componentDidUpdate() {\n    this.popoverController.setOpen(this.open);\n    if (this.open) {\n      this.popoverController.computePositionThrottle('onUpdate');\n    }\n  }\n\n  /**\n   * 组件断开连接生命周期钩子\n   * 清理Popover控制器\n   */\n  disconnectedCallback() {\n    this.popoverController.destroy();\n  }\n\n  /**\n   * 隐藏下拉菜单的回调函数\n   */\n  hidePopover = () => {\n    this.open = false;\n    this.closeEvent.emit();\n  };\n\n  /**\n   * 渲染组件\n   * @returns 组件虚拟DOM\n   */\n  render() {\n    return (\n      <Host>\n        <div\n          class={{\n            dropdown: true,\n            open: this.open,\n          }}\n        >\n          <slot ref={(el) => (this.slotRef = el as HTMLSlotElement)} />\n        </div>\n      </Host>\n    );\n  }\n\n  /**\n   * 监听窗口resize事件\n   * 调整下拉菜单位置\n   * @Listen 装饰器监听window的resize事件\n   */\n  @Listen('resize', { target: 'window' })\n  resizeHandler() {\n    this.popoverController.computePositionThrottle('resize');\n  }\n\n  /**\n   * 设置焦点的公共方法\n   * @Method 装饰器定义公共方法\n   */\n  @Method()\n  async setFocus() {\n    this.setFocusOnTrigger();\n  }\n\n  /**\n   * 将焦点设置到触发器元素\n   */\n  setFocusOnTrigger() {\n    (this.triggerRef as HTMLZaneButtonElement).setFocus\n      ? (this.triggerRef as HTMLZaneButtonElement).setFocus()\n      : this.triggerRef.focus();\n  }\n\n  /**\n   * 显示下拉菜单的回调函数\n   */\n  showPopover = () => {\n    this.open = true;\n    setTimeout(() => {\n      this.menuRef.setFocus();\n      this.openEvent.emit();\n    });\n  };\n\n  /**\n   * 监听window的click事件\n   * 处理点击外部关闭下拉菜单\n   * @Listen 装饰器监听window的click事件\n   * @param evt 点击事件对象\n   */\n  @Listen('click', { target: 'window' })\n  windowClickHandler(evt) {\n    this.popoverController.windowClickHandler(evt);\n  }\n}\n"],"mappings":"oJAAA,MAAMA,EAAc,u5F,MC2BPC,EAAQ,MALrB,WAAAC,CAAAC,G,qKAkBUC,KAAQC,SAAY,MAaHD,KAAOE,QAAY,MAWJF,KAAIG,KAAY,MAe/BH,KAAUI,WACjC,4CAqBuBJ,KAAOK,QAAiC,QAkGjEL,KAAWM,YAAG,KACZN,KAAKG,KAAO,MACZH,KAAKO,WAAWC,MAAM,EAqDxBR,KAAWS,YAAG,KACZT,KAAKG,KAAO,KACZO,YAAW,KACTV,KAAKW,QAAQC,WACbZ,KAAKa,UAAUL,MAAM,GACrB,CAaL,CAvJC,gBAAAM,GAEE,MAAMC,EAAaf,KAAKgB,KAAKC,cAAc,sBAE3C,IAAKF,EAAY,CACf,MAAM,IAAIG,MACR,uF,CAIJlB,KAAKW,QAAUI,EAGff,KAAKmB,kBAAoB,IAAIC,EAC3BpB,KAAKgB,KACLhB,KAAKK,QACLL,KAAKG,KACLY,EACA,EACA,EACAf,KAAKS,YACLT,KAAKM,YACLN,KAAKI,YAIPJ,KAAKqB,WAAarB,KAAKsB,QAAQC,mBAAmB,GAClD,GAAIvB,KAAKqB,WAAWG,WAAa,OAAQ,CACvC,MAAMD,EACJvB,KAAKqB,WACLE,mBACF,GAAIA,EAAiBE,OAAS,EAAG,CAC/BzB,KAAKqB,WAAaE,EAAiB,E,EAKvCvB,KAAKmB,kBAAkBO,eAAe1B,KAAKqB,YAC3CrB,KAAKmB,kBAAkBQ,cAAc3B,KAAKqB,YAG1CrB,KAAKgB,KAAKY,iBAAiB,yBAA0BC,IACnD7B,KAAK8B,sBAAsBtB,KAAKqB,EAAIE,QACpC/B,KAAKgC,oBACLhC,KAAKmB,kBAAkBb,aAAa,IAItCN,KAAKgB,KAAKY,iBAAiB,WAAYC,IACrC,GAAIA,EAAII,MAAQ,SAAU,CACxBJ,EAAIK,iBACJlC,KAAKmB,kBAAkBb,a,KAS7B,kBAAA6B,GACEnC,KAAKmB,kBAAkBiB,QAAQpC,KAAKG,MACpC,GAAIH,KAAKG,KAAM,CACbH,KAAKmB,kBAAkBkB,wBAAwB,W,EAQnD,oBAAAC,GACEtC,KAAKmB,kBAAkBoB,S,CAezB,MAAAC,GACE,OACEC,EAACC,EAAI,CAAAT,IAAA,4CACHQ,EAAA,OAAAR,IAAA,2CACEU,MAAO,CACLC,SAAU,KACVzC,KAAMH,KAAKG,OAGbsC,EAAA,QAAAR,IAAA,2CAAMY,IAAMC,GAAQ9C,KAAKsB,QAAUwB,K,CAY3C,aAAAC,GACE/C,KAAKmB,kBAAkBkB,wBAAwB,S,CAQjD,cAAMzB,GACJZ,KAAKgC,mB,CAMP,iBAAAA,GACGhC,KAAKqB,WAAqCT,SACtCZ,KAAKqB,WAAqCT,WAC3CZ,KAAKqB,WAAW2B,O,CAqBtB,kBAAAC,CAAmBpB,GACjB7B,KAAKmB,kBAAkB8B,mBAAmBpB,E","ignoreList":[]}