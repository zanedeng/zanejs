{"version":3,"file":"p-CqFT_RnK.js","sources":["src/utils/isDarkMode.ts","src/utils/observeThemeChange.ts"],"sourcesContent":["/**\n * 检测当前是否处于暗黑模式\n * @returns 返回布尔值表示是否启用暗黑模式\n *\n * @remarks\n * 通过检查文档根元素的 data-theme 属性来判断\n * 同时支持系统级暗色模式偏好检测作为后备方案\n *\n * @example\n * if (isDarkMode()) {\n *   // 应用暗黑模式样式\n * }\n */\nexport function isDarkMode(): boolean {\n  try {\n    // 显式主题设置优先\n    const theme = document.documentElement.dataset.theme;\n    if (theme) {\n      return theme === 'dark';\n    }\n\n    // 后备方案：检测系统级颜色方案偏好\n    return window.matchMedia?.('(prefers-color-scheme: dark)').matches ?? false;\n  } catch (error) {\n    // 在非浏览器环境或DOM不可用时安全降级\n    console.warn('Dark mode detection failed:', error);\n    return false;\n  }\n}\n","type ThemeChangeCallback = (\n  newTheme: null | string,\n  oldTheme: null | string,\n) => void;\n\n/**\n * 主题变化观察器 (基于 MutationObserver)\n * 高效监听文档根元素 data-theme 属性的变化\n *\n * @returns 返回一个订阅函数，该函数返回取消订阅的方法\n *\n * @example\n * // 订阅主题变化\n * const unsubscribe = observeThemeChange((newTheme, oldTheme) => {\n *   console.log(`主题从 ${oldTheme} 变更为 ${newTheme}`);\n * });\n *\n * // 取消订阅\n * unsubscribe();\n */\nexport const observeThemeChange = ((): ((\n  callback: ThemeChangeCallback,\n) => () => void) => {\n  // 存储所有回调函数和上一次的主题值\n  const callbackEntries = new Map<\n    ThemeChangeCallback,\n    { lastTheme: null | string }\n  >();\n\n  // 共享的 MutationObserver 实例\n  let observer: MutationObserver | null = null;\n\n  // 检查并初始化观察器\n  const ensureObserver = () => {\n    if (!observer) {\n      observer = new MutationObserver((mutations) => {\n        const themeMutation = mutations.find(\n          (m) => m.attributeName === 'data-theme',\n        );\n        if (!themeMutation) return;\n\n        const target = themeMutation.target as HTMLElement;\n        const currentTheme = target.dataset.theme;\n\n        // 通知所有订阅者\n        callbackEntries.forEach((entry, callback) => {\n          if (entry.lastTheme !== currentTheme) {\n            callback(currentTheme, entry.lastTheme);\n            entry.lastTheme = currentTheme;\n          }\n        });\n      });\n\n      observer.observe(document.documentElement, {\n        attributeFilter: ['data-theme'],\n        attributes: true,\n      });\n    }\n  };\n\n  // 清理无用的观察器\n  const cleanupObserver = () => {\n    if (observer && callbackEntries.size === 0) {\n      observer.disconnect();\n      observer = null;\n    }\n  };\n\n  return (callback: ThemeChangeCallback) => {\n    // 初始化记录\n    callbackEntries.set(callback, {\n      lastTheme: document.documentElement.dataset.theme,\n    });\n\n    ensureObserver();\n\n    // 返回取消订阅函数\n    return () => {\n      callbackEntries.delete(callback);\n      cleanupObserver();\n    };\n  };\n})();\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;;AAYG;SACa,UAAU,GAAA;;AACxB,IAAA,IAAI;;QAEF,MAAM,KAAK,GAAG,QAAQ,CAAC,eAAe,CAAC,OAAO,CAAC,KAAK;QACpD,IAAI,KAAK,EAAE;YACT,OAAO,KAAK,KAAK,MAAM;;;QAIzB,OAAO,CAAA,EAAA,GAAA,CAAA,EAAA,GAAA,MAAM,CAAC,UAAU,MAAG,IAAA,IAAA,EAAA,KAAA,MAAA,GAAA,MAAA,GAAA,EAAA,CAAA,IAAA,CAAA,MAAA,EAAA,8BAA8B,CAAE,CAAA,OAAO,MAAI,IAAA,IAAA,EAAA,KAAA,MAAA,GAAA,EAAA,GAAA,KAAK;;IAC3E,OAAO,KAAK,EAAE;;AAEd,QAAA,OAAO,CAAC,IAAI,CAAC,6BAA6B,EAAE,KAAK,CAAC;AAClD,QAAA,OAAO,KAAK;;AAEhB;;ACvBA;;;;;;;;;;;;;;AAcG;AACU,MAAA,kBAAkB,GAAG,CAAC,MAEhB;;AAEjB,IAAA,MAAM,eAAe,GAAG,IAAI,GAAG,EAG5B;;IAGH,IAAI,QAAQ,GAA4B,IAAI;;IAG5C,MAAM,cAAc,GAAG,MAAK;QAC1B,IAAI,CAAC,QAAQ,EAAE;AACb,YAAA,QAAQ,GAAG,IAAI,gBAAgB,CAAC,CAAC,SAAS,KAAI;AAC5C,gBAAA,MAAM,aAAa,GAAG,SAAS,CAAC,IAAI,CAClC,CAAC,CAAC,KAAK,CAAC,CAAC,aAAa,KAAK,YAAY,CACxC;AACD,gBAAA,IAAI,CAAC,aAAa;oBAAE;AAEpB,gBAAA,MAAM,MAAM,GAAG,aAAa,CAAC,MAAqB;AAClD,gBAAA,MAAM,YAAY,GAAG,MAAM,CAAC,OAAO,CAAC,KAAK;;gBAGzC,eAAe,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,QAAQ,KAAI;AAC1C,oBAAA,IAAI,KAAK,CAAC,SAAS,KAAK,YAAY,EAAE;AACpC,wBAAA,QAAQ,CAAC,YAAY,EAAE,KAAK,CAAC,SAAS,CAAC;AACvC,wBAAA,KAAK,CAAC,SAAS,GAAG,YAAY;;AAElC,iBAAC,CAAC;AACJ,aAAC,CAAC;AAEF,YAAA,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,eAAe,EAAE;gBACzC,eAAe,EAAE,CAAC,YAAY,CAAC;AAC/B,gBAAA,UAAU,EAAE,IAAI;AACjB,aAAA,CAAC;;AAEN,KAAC;;IAGD,MAAM,eAAe,GAAG,MAAK;QAC3B,IAAI,QAAQ,IAAI,eAAe,CAAC,IAAI,KAAK,CAAC,EAAE;YAC1C,QAAQ,CAAC,UAAU,EAAE;YACrB,QAAQ,GAAG,IAAI;;AAEnB,KAAC;IAED,OAAO,CAAC,QAA6B,KAAI;;AAEvC,QAAA,eAAe,CAAC,GAAG,CAAC,QAAQ,EAAE;AAC5B,YAAA,SAAS,EAAE,QAAQ,CAAC,eAAe,CAAC,OAAO,CAAC,KAAK;AAClD,SAAA,CAAC;AAEF,QAAA,cAAc,EAAE;;AAGhB,QAAA,OAAO,MAAK;AACV,YAAA,eAAe,CAAC,MAAM,CAAC,QAAQ,CAAC;AAChC,YAAA,eAAe,EAAE;AACnB,SAAC;AACH,KAAC;AACH,CAAC;;;;"}