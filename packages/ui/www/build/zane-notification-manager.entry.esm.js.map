{"version":3,"file":"zane-notification-manager.entry.esm.js","sources":["src/components/notification-manager/notification-manager.scss?tag=zane-notification-manager&encapsulation=shadow","src/components/notification-manager/notification-manager.tsx"],"sourcesContent":["@use '../../global/styles/commons';\n\n@keyframes revealTop {\n  0% {\n    max-height: 0;\n    opacity: 0;\n    transform: translateY(-1rem);\n  }\n\n  100% {\n    max-height: 500px;\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n@keyframes revealBottom {\n  0% {\n    max-height: 0;\n    opacity: 0;\n    transform: translateY(1rem);\n  }\n\n  100% {\n    max-height: 500px;\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n:host {\n  position: absolute;\n  z-index: var(--z-index-notification-manager);\n  display: block;\n  pointer-events: none;\n}\n\n:host([name='global']) {\n  position: fixed;\n  width: 300px;\n}\n\n.notification-manager {\n  display: flex;\n  flex-direction: column;\n  margin: var(--spacing-04);\n  pointer-events: none;\n\n  .notification {\n    height: auto;\n    max-height: 500px;\n    pointer-events: auto;\n    transition: all 0.5s ease-out;\n  }\n\n  .notification.hidden {\n    max-height: 0;\n    overflow: hidden;\n    opacity: 0;\n  }\n}\n\n:host([position='bottom-right']) {\n  right: 0;\n  bottom: 0;\n\n  .notification {\n    animation: revealBottom 0.5s ease-in;\n  }\n\n  .notification-manager {\n    align-items: flex-end;\n  }\n}\n\n:host([position='bottom-left']) {\n  bottom: 0;\n  left: 0;\n\n  .notification {\n    animation: revealBottom 0.5s ease-in;\n  }\n\n  .notification-manager {\n    align-items: flex-start;\n  }\n}\n\n:host([position='top-left']) {\n  top: 0;\n  left: 0;\n\n  .notification {\n    animation: revealTop 0.5s ease-in;\n  }\n\n  .notification-manager {\n    align-items: flex-start;\n  }\n}\n\n:host([position='top-right']) {\n  top: 0;\n  right: 0;\n\n  .notification {\n    animation: revealTop 0.5s ease-in;\n  }\n\n  .notification-manager {\n    align-items: flex-end;\n  }\n}\n","import {\n  Component,\n  ComponentInterface,\n  Element,\n  h,\n  Host,\n  Listen,\n  Prop,\n  State,\n} from '@stencil/core';\nimport DOMPurify from 'dompurify';\n\nimport { getComponentIndex, isDarkMode, observeThemeChange } from '../../utils';\n\n/**\n * 通知ID生成器闭包\n * @private\n * @function getNotificationIndex\n * @returns {function} 返回自增ID生成函数\n */\nconst getNotificationIndex = (() => {\n  let counter = 1;\n  return function () {\n    return `${counter++}`;\n  };\n})();\n\n/**\n * 通知对象类型定义\n * @typedef {Object} Notification\n * @property {string} [action] - 操作按钮文本（可选）\n * @property {boolean} dismissible - 是否可关闭\n * @property {boolean} hide - 是否隐藏状态\n * @property {string} id - 全局唯一通知ID\n * @property {string} state - 通知状态类型\n * @property {string} [subtitle] - 副标题HTML内容（可选）\n * @property {number} timeout - 自动关闭超时（毫秒）\n * @property {string} title - 标题HTML内容\n * @property {string} [width] - 自定义宽度（CSS单位）\n */\ntype Notification = {\n  action?: string;\n  dismissible: boolean;\n  hide: boolean;\n  id: string;\n  state: string;\n  subtitle?: string;\n  timeout: number;\n  title: string;\n  width?: string;\n};\n\n/**\n * 智能通知管理系统组件 (zane-notification-manager)\n *\n * @component zane-notification-manager\n * @shadow true\n *\n * @description\n * 全局通知管理中心，提供以下核心能力：\n * 1. 跨组件通知聚合：通过事件总线收集全应用通知\n * 2. 多位置布局：支持4种屏幕定位策略\n * 3. 生命周期管理：自动关闭/手动关闭/防重复\n * 4. 安全渲染：内置DOM净化防止XSS攻击\n * 5. 主题适配：自动同步暗黑模式状态\n *\n * @example\n * <!-- 基础用法 -->\n * <zane-notification-manager position=\"top-right\"></zane-notification-manager>\n *\n * <!-- 自定义命名管理器 -->\n * <zane-notification-manager name=\"dashboard\" position=\"bottom-left\"></zane-notification-manager>\n */\n@Component({\n  shadow: true,\n  styleUrl: 'notification-manager.scss',\n  tag: 'zane-notification-manager',\n})\nexport class NotificationManager implements ComponentInterface {\n  /** 宿主元素引用 */\n  @Element() elm!: HTMLElement;\n\n  /** 组件实例唯一标识 */\n  gid: string = getComponentIndex();\n\n  /** 当前是否为暗黑模式 */\n  @State() isDarkMode: boolean = isDarkMode();\n\n  /**\n   * 管理器命名空间\n   * @prop {string} [name='global'] - 管理器唯一标识\n   * - `global`：默认全局管理器，接收未指定目标的通告\n   * - 自定义名：只接收相同target参数的通告\n   * @example\n   * // 发送到指定管理器\n   * const event = new CustomEvent('zane-notification', {\n   *   detail: { target: 'dashboard', title: '数据更新完成' }\n   * });\n   * window.dispatchEvent(event);\n   */\n  @Prop({ reflect: true }) name: string = 'global';\n\n  /** 通知队列状态 */\n  @State() notifications: any = [];\n\n  /**\n   * 通知定位策略\n   * @prop {'top-left'|'top-right'|'bottom-left'|'bottom-right'} [position='bottom-right'] - 通知容器屏幕位置\n   *\n   * @option top-left - 左上角定位\n   * - 适用场景：重要实时状态更新（如系统监控）\n   * - 设计规范：距顶部20px，距左侧20px\n   *\n   * @option top-right - 右上角定位（默认）\n   * - 适用场景：通用信息提示（如操作反馈）\n   * - 设计规范：距顶部20px，距右侧20px\n   *\n   * @option bottom-left - 左下角定位\n   * - 适用场景：后台任务通知（如文件下载）\n   * - 设计规范：距底部20px，距左侧20px\n   *\n   * @option bottom-right - 右下角定位\n   * - 适用场景：非紧急通知（如新闻推送）\n   * - 设计规范：距底部20px，距右侧20px\n   */\n  @Prop({ reflect: true }) position:\n    | 'bottom-left'\n    | 'bottom-right'\n    | 'top-left'\n    | 'top-right' = 'bottom-right';\n\n  componentWillLoad() {\n    observeThemeChange(() => {\n      this.isDarkMode = isDarkMode();\n    });\n  }\n\n  /**\n   * 全局通知事件监听器\n   * @listens window:zane-notification\n   * @param {CustomEvent} evt - 通知事件对象\n   */\n  @Listen('zane-notification', { target: 'window' })\n  listenNotification(evt: CustomEvent) {\n    if (\n      (evt.detail.target === this.name || this.name === 'global') &&\n      !evt.detail.procced\n    ) {\n      evt.preventDefault();\n      evt.stopPropagation();\n      evt.detail.procced = true;\n      const notification: Notification = {\n        action: evt.detail.action,\n        dismissible: evt.detail.dismissible,\n\n        hide: false,\n        id: `notification-${this.gid}-${getNotificationIndex()}`,\n        state: evt.detail.state,\n        subtitle: evt.detail.subtitle,\n        timeout: evt.detail.timeout,\n        title: evt.detail.title,\n        width: evt.detail.width,\n      };\n      this.notifications = this.notifications\n        .concat([notification])\n        .filter((n) => !n.hide);\n\n      if (evt.detail.callback) {\n        evt.detail.callback(notification.id);\n      }\n\n      if (!notification.dismissible)\n        setTimeout(() => {\n          notification.hide = true;\n          this.notifications = [...this.notifications];\n        }, notification.timeout || 5000);\n    }\n  }\n\n  /**\n   * 通知关闭事件监听器\n   * @listens window:zane-notification-dismiss\n   * @param {CustomEvent} evt - 关闭事件对象\n   */\n  @Listen('zane-notification-dismiss', { target: 'window' })\n  listenNotificationDismiss(evt: CustomEvent) {\n    const notifications = this.notifications.filter((n) =>\n      evt.detail.notifications.includes(n.id),\n    );\n    notifications.forEach((n) => (n.hide = true));\n    this.notifications = [...this.notifications];\n  }\n\n  /**\n   * 主渲染方法\n   * @returns {JSX.Element} 虚拟DOM结构\n   *\n   * @domStructure\n   * <zane-notification-manager>\n   *   <div class=\"notification-manager position-{placement}\">\n   *     <div class=\"notification\" id={id} hidden={hide}>\n   *       <!-- 通过renderNotification生成 -->\n   *     </div>\n   *   </div>\n   * </zane-notification-manager>\n   */\n  render() {\n    return (\n      <Host>\n        <div\n          class={{\n            [`position-${this.position}`]: true,\n            'notification-manager': true,\n          }}\n        >\n          {this.notifications.map((notification) => (\n            <div\n              class={{ hidden: notification.hide, notification: true }}\n              id={notification.id}\n            >\n              {this.renderNotification(notification)}\n            </div>\n          ))}\n        </div>\n      </Host>\n    );\n  }\n\n  /**\n   * 通知项渲染器\n   * @private\n   * @param {Notification} notification - 通知对象\n   * @returns {JSX.Element} zane-notification组件实例\n   *\n   * @securityFeature\n   * 使用DOMPurify对title/subtitle进行XSS过滤\n   * - 允许标签：<b>, <i>, <a>, <br>\n   * - 过滤属性：移除所有on*事件处理器\n   * - 安全协议：强制将http链接转为https\n   */\n  renderNotification(notification) {\n    return (\n      <zane-notification\n        action={notification.action}\n        dismissible={notification.dismissible}\n        managed={true}\n        onZane-notification--dismiss={() => {\n          notification.hide = true;\n          this.notifications = [...this.notifications];\n        }}\n        state={notification.state}\n        style={{ width: notification.width }}\n      >\n        <div innerHTML={DOMPurify.sanitize(notification.title)} slot=\"title\" />\n        <div\n          innerHTML={DOMPurify.sanitize(notification.subtitle)}\n          slot=\"subtitle\"\n        />\n      </zane-notification>\n    );\n  }\n}\n"],"names":["DOMPurify"],"mappings":"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"}